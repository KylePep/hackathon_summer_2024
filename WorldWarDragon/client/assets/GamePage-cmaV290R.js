var t=Object.defineProperty;import{P as e,p as s}from"./phaser-Di_ahE-K.js";import{A as i,l as a,e as o,i as n,y as h,P as r,z as c,r as l,o as d,C as g,D as u,a as m,c as p,m as f,f as k,s as w}from"./index-D__TAhnb.js";import{D as v,a as B,M as y}from"./index-BhTZ9iIM.js";const b=new e.Events.EventEmitter;class S extends s.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}class x{constructor(t,e,s){this.scene=t,this.dragonHP=this.getRandomDragonHP(),this.dragonHPMax=this.dragonHP,this.bossDamage=Phaser.Math.RoundTo(.1*this.dragonHP,0),this.activeRoomId=i.activeRoom.id,this.activeRoomId&&5!=this.activeRoomId?this.goldMod=i.goldMod[this.activeRoomId]:this.goldMod=0,this.modifier=Phaser.Math.RND.pick([1.1,.9]),this.gold=Phaser.Math.RoundTo(this.bossDamage+this.goldMod*this.modifier,0),this.valor=Phaser.Math.RoundTo(.1*this.bossDamage,0),this.dragon=this.scene.add.sprite(e,s,this.getRandomDragonSprite()).setOrigin(.5,.5),this.setScaleToFitWindow(0),this.scene.scale.on("resize",this.setScaleToFitWindow,this),this.originalX=this.dragon.x,this.originalY=this.dragon.y,this.originalAngle=0,this.dragon.setInteractive(),this.addInteractions(),this.setupEventListeners()}setScaleToFitWindow(t){const{width:e,height:s}=this.scene.cameras.main,i=e/this.dragon.width,a=s/this.dragon.height,o=.5*Math.min(i,a)+t;this.dragon.setScale(o)}getRandomDragonHP(){return Phaser.Math.Between(10,100)*(1+i.activeRoom.difficulty*i.activeRoom.difficulty)}getRandomDragonSprite(){return Phaser.Math.RND.pick(["dragon_1","dragon_3","dragon_4","dragon_5","dragon_6","dragon_7","dragon_8","dragon_9"])}getRandomDragonSound(){return Phaser.Math.RND.pick(["swish_2","swish_3","swish_4"])}addInteractions(){this.dragon.on("pointerdown",(()=>{this.onDragonHit()})),this.dragon.on("pointerover",(()=>{this.onPointerOver()})),this.dragon.on("pointerout",(()=>{this.onPointerOut()}))}setupEventListeners(){this.scene.events.on("dragon:hit",this.onDragonHit,this),this.scene.events.on("dragon:over",this.onPointerOver,this),this.scene.events.on("dragon:out",this.onPointerOut,this),this.scene.events.on("dragon:attackItem",this.onAttackItem,this)}checkDeath(){this.dragonHP<=0&&(i.bossDamage=this.bossDamage,i.winStreak++,i.gold=Phaser.Math.RoundTo(this.gold+this.gold*(.025*i.winStreak),0),i.valor=Phaser.Math.RoundTo(this.valor+this.valor*(.025*i.winStreak),0),this.scene.events.off("dragon:hit"),this.scene.events.off("dragon:over"),this.scene.events.off("dragon:out"),this.scene.events.off("dragon:attackItem"),this.scene.playerHp=this.scene.playerMaxHp,this.scene.leaveRoom())}onAttackItem(){const t=this.scene.sound.add("attackItem");t.play(),t.volume=1,this.dragonHP=Phaser.Math.RoundTo(this.dragonHP/2,0),this.scene.bossUi.updateBossHp(this.dragonHP),this.checkDeath(),this.scene.tweens.add({targets:this.dragon,duration:300,ease:"Power1",x:this.dragon.x+Phaser.Math.RND.between(-16,16),y:this.dragon.y+Phaser.Math.RND.between(-16,16),angle:this.dragon.angle+Phaser.Math.RND.between(-16,16),yoyo:!0,repeat:0,onStart:()=>{this.dragon.setTint(16711680)},onComplete:()=>{this.dragon.x=this.originalX,this.dragon.y=this.originalY,this.dragon.angle=this.originalAngle,this.dragon.clearTint()}})}onDragonHit(){const t=this.getRandomDragonSound(),e=this.scene.sound.add(t);e.play(),e.volume=.2,this.dragonHP-=i.account.power+(i.powerMod[i.activeRoom.id]||0),this.scene.bossUi.updateBossHp(this.dragonHP),this.checkDeath(),this.scene.tweens.add({targets:this.dragon,duration:100,ease:"Power1",x:this.dragon.x+Phaser.Math.RND.between(-16,16),y:this.dragon.y+Phaser.Math.RND.between(-16,16),angle:this.dragon.angle+Phaser.Math.RND.between(-16,16),yoyo:!0,repeat:0,onComplete:()=>{this.dragon.x=this.originalX,this.dragon.y=this.originalY,this.dragon.angle=this.originalAngle}})}onPointerOver(){this.setScaleToFitWindow(.2),this.dragon.y-=8,this.scene.input.setDefaultCursor("pointer")}onPointerOut(){this.setScaleToFitWindow(0),this.dragon.y=this.originalY,this.scene.input.setDefaultCursor("default")}}class T{constructor(t,e,s){this.scene=t,this.slashes=["small_0001","small_0004","small_0006","small_0010","small_0015","small_0019","small_0020","small_0022","small_0026","small_0030","small_0032","small_0034","small_0036","small_0037"],this.interactiveSlash=this.scene.add.sprite(e,s,"star").setOrigin(.5,.5),this.interactiveSlash.setAlpha(.1),this.interactiveSlash.setInteractive(),this.addInteractions(),this.displaySlash=this.scene.add.sprite(e,s,"small_0001").setOrigin(.5,.5),this.displaySlash.setAlpha(0),this.setScaleToFitWindow(0),this.scene.scale.on("resize",this.setScaleToFitWindow,this)}setScaleToFitWindow(t){const{width:e,height:s}=this.scene.cameras.main,i=e/this.interactiveSlash.width,a=s/this.interactiveSlash.height,o=.25*Math.min(i,a)+t;this.interactiveSlash.setScale(o),this.displaySlash.setScale(o)}getRandomSlash(){return Phaser.Math.RND.pick(this.slashes)}getRandomDragonSound(){return Phaser.Math.RND.pick(["swish_2","swish_3","swish_4"])}addInteractions(){this.interactiveSlash.on("pointerdown",(t=>{this.scene.events.emit("dragon:hit",t)})),this.interactiveSlash.on("pointerover",(t=>{this.entryState="enter",this.setScaleToFitWindow(.2),this.scene.events.emit("dragon:over",t)})),this.interactiveSlash.on("pointerout",(t=>{this.displaySlash.setTexture(this.getRandomSlash()),this.setScaleToFitWindow(0),this.displaySlash.setAngle(Phaser.Math.RND.between(0,180)),this.displaySlash.setAlpha(1),this.fadeOutSprite(),this.scene.events.emit("dragon:out",t),"enter"===this.entryState&&(this.entryState="exit",this.scene.events.emit("dragon:hit",t))}))}fadeOutSprite(){this.scene.tweens.add({targets:this.displaySlash,alpha:0,duration:300,ease:"Linear",onStart:()=>{this.displaySlash.alpha=1}})}destroy(){this.interactiveSlash.off("pointerdown"),this.interactiveSlash.off("pointerover"),this.interactiveSlash.off("pointerout"),this.hitbox.destroy(),this.interactiveSlash.destroy()}}class D{constructor(t,e,s){this.scene=t,this.x=e,this.y=s,this.items=["attack","shield","heal"],this.patterns={attack:[0,3,1,2],attackAlt:[2,1,3,0],shield:[0,3,2,1],shieldAlt:[1,2,3,0],heal:[0,2,1,3],healAlt:[3,1,2,0]},this.inputCode=[],this.action="input",this.interactiveObjects=[],this.lines=[],this.isDrawing=!1,this.lineWidth=5,this.createInteractiveObjects()}createInteractiveObjects(){i.account.attack+i.account.attackAid+i.account.shield+i.account.shieldAid+i.account.heal+i.account.healAid>0&&([{x:this.x,y:this.y-300,id:0},{x:this.x,y:this.y+300,id:2},{x:this.x+300,y:this.y,id:1},{x:this.x-300,y:this.y,id:3}].forEach(((t,e)=>{const s=this.scene.add.sprite(t.x,t.y,"star").setInteractive().setDepth(200);s.id=t.id,s.on("pointerover",(()=>{this.isDrawing&&(this.setInputCode(s.id),s.setTint(49663),this.addStaticLine(s))})),s.on("pointerout",(()=>{this.isDrawing||s.setTint(16777215)})),s.on("pointerdown",(t=>{this.isDrawing?(this.stopDrawing(s),s.setTint(16777215)):(this.startDrawing(s.x,s.y,s),s.setTint(49663),this.inputCode.push(s.id))})),this.interactiveObjects.push(s)})),this.scene.input.on("pointermove",(t=>{this.isDrawing&&this.updateLine(t.x,t.y)})),this.scene.input.on("pointerup",(t=>{this.isDrawing&&this.cancelDrawing()})))}startDrawing(t,e,s){this.lines.length>=4?this.stopDrawing(s):(this.isDrawing=!0,this.startX=t,this.startY=e,this.currentLine=this.scene.add.line(0,0,t,e,t,e,49663).setOrigin(0,0).setDepth(100).setLineWidth(this.lineWidth),this.lines.push(this.currentLine),this.startObject=s)}updateLine(t,e){if(this.currentLine){const s=t-this.startX,i=e-this.startY,a=Math.sqrt(s*s+i*i),o=Phaser.Math.Angle.Between(this.startX,this.startY,t,e);this.currentLine.setTo(this.startX,this.startY,this.startX+a*Math.cos(o),this.startY+a*Math.sin(o))}}addStaticLine(t){if(this.currentLine){const e=this.currentLine,s=t.x-this.startX,i=t.y-this.startY,o=Math.sqrt(s*s+i*i),n=Phaser.Math.Angle.Between(this.startX,this.startY,t.x,t.y);e.setTo(this.startX,this.startY,this.startX+o*Math.cos(n),this.startY+o*Math.sin(n)),e.setLineWidth(this.lineWidth),this.inputCode.length<4?(a.log("inputCode",this.inputCode),this.startDrawing(t.x,t.y,t)):(a.log("inputCode",this.inputCode),this.stopDrawing(t))}}stopDrawing(t){if(this.isDrawing=!1,this.startObject!==t){const e=this.currentLine;if(e){const s=t.x-this.startX,i=t.y-this.startY,a=Math.sqrt(s*s+i*i),o=Phaser.Math.Angle.Between(this.startX,this.startY,t.x,t.y);e.setTo(this.startX,this.startY,this.startX+a*Math.cos(o),this.startY+a*Math.sin(o)),e.setLineWidth(this.lineWidth),this.checkInputCode(),this.cancelDrawing()}}else this.cancelDrawing()}setInputCode(t){this.inputCode[this.inputCode.length-1]!=t&&this.inputCode.push(t)}checkInputCode(){if("input"==this.action){const t=this.inputCode.join(","),e={attack:this.patterns.attack.join(","),attackAlt:this.patterns.attack.reverse().join(","),shield:this.patterns.shield.join(","),shieldAlt:this.patterns.shield.reverse().join(","),heal:this.patterns.heal.join(","),healAlt:this.patterns.heal.reverse().join(",")};t===e.attack||t===e.attackAlt?this.action="attack":t===e.shield||t===e.shieldAlt?this.action="shield":t!==e.heal&&t!==e.healAlt||(this.action="heal")}if(a.log("ACTION",this.action),"input"!=this.action){if(i.account[this.action]>0||i.account[`${this.action}Aid`]>0){i.account[`${this.action}Aid`]>0?i.account[`${this.action}Aid`]-=1:i.account[this.action]-=1;const t=i.account;o.editAccount(t),this.useItem()}else{i.account[this.action]=0,i.account[`${this.action}Aid`]=0;const t=i.account;o.editAccount(t)}this.action="input"}this.inputCode=[]}useItem(){if("attack"==this.action)this.scene.events.emit("dragon:attackItem"),this.scene.playerUi.updateItem();else if("shield"==this.action)this.scene.events.emit("dragon:shieldItem"),this.scene.playerUi.updateItem();else if("heal"==this.action){const t="healItem",e=this.scene.sound.add(t);e.play(),e.volume=1,this.scene.playerHp=this.scene.playerMaxHp,this.scene.playerUi.updatePlayerHp(this.scene.playerHp),this.scene.playerUi.updateItem()}}cancelDrawing(){this.isDrawing=!1,this.lines.forEach((t=>t.destroy())),this.lines=[],this.interactiveObjects.forEach((t=>t.setTint(16777215))),this.inputCode=[]}}class A extends s.GameObjects.Container{constructor(t,e){super(t,e.x,e.y+50),this.scene=t,this.dragon=e,this.attackInterval=5e3,this.lastAttackTime=this.scene.time.now,this.dragonSounds=["dragonAttack_1","dragonAttack_2","dragonAttack_3","dragonAttack_4","dragonAttack_5"],this.progressBar=this.scene.add.graphics(),this.progressBarBackground=this.scene.add.graphics(),this.add(this.progressBarBackground),this.add(this.progressBar),this.progressBarWidth=100,this.progressBarHeight=10,this.scene.add.existing(this)}startAttack(){this.lastAttackTime=this.scene.time.now,this.scene.time.addEvent({delay:this.attackInterval,callback:this.attack,callbackScope:this,loop:!0})}attack(){const t=this.getRandomSound(),e=this.scene.sound.add(t);e.play(),e.volume=.5,a.log("PLAYERHP",this.scene.playerHp),this.scene.playerHp-=10*i.activeRoom.difficulty,this.scene.playerUi.updatePlayerHp(this.scene.playerHp),this.scene.playerHp<=0&&(this.scene.sound.stopAll(),this.scene.scene.start("GameOver")),this.lastAttackTime=this.scene.time.now}getRandomSound(){return Phaser.Math.RND.pick(this.dragonSounds)}updateProgressBar(){const t=(this.scene.time.now-this.lastAttackTime)/this.attackInterval;this.progressBar.clear(),this.progressBarBackground.clear(),this.progressBarBackground.fillStyle(0,.5),this.progressBarBackground.fillRect(-this.progressBarWidth/2,-this.progressBarHeight/2,this.progressBarWidth,this.progressBarHeight),this.progressBar.fillStyle(16711680,1),this.progressBar.fillRect(-this.progressBarWidth/2,-this.progressBarHeight/2,this.progressBarWidth*t,this.progressBarHeight)}update(){this.updateProgressBar()}setProgressBarSize(t,e){this.progressBarWidth=t,this.progressBarHeight=e,this.updateProgressBar()}updatePosition(){this.setPosition(this.scene.dragon.x,this.scene.dragon.y+50)}}class _{constructor(t,e,s,i,a){this.scene=t,this.bossName=e,this.bossTitle=s,this.bossHp=i,this.maxHp=a,this.createUI(),this.setScaleToFitWindow(),this.scene.scale.on("resize",this.setScaleToFitWindow,this)}createUI(){const{width:t,height:e}=this.scene.cameras.main;this.bossUiContainer=this.scene.add.container(0,e),this.bottomBar=this.scene.add.rectangle(t/2,0,t,80,0).setOrigin(.5,1),this.bossUiContainer.add(this.bottomBar),this.retreatButton=this.scene.add.text(10,-40,"RETREAT...",{fontSize:"20px",color:"gray"}).setOrigin(0,1).setDepth(100).setInteractive(),this.retreatButton.on("pointerdown",(()=>{b.emit("navigate-home")})),this.retreatButton.on("pointerover",(()=>{this.retreatButton.setColor("white"),this.scene.input.setDefaultCursor("pointer")})),this.retreatButton.on("pointerout",(()=>{this.retreatButton.setColor("gray"),this.scene.input.setDefaultCursor("default")})),this.bossUiContainer.add(this.retreatButton),this.bossNameText=this.scene.add.text(t/2,-40,this.bossName,{fontSize:"20px",fill:"#ffffff"}).setOrigin(.5,1),this.bossUiContainer.add(this.bossNameText),this.bossTitleText=this.scene.add.text(t/2,-20,this.bossTitle,{fontSize:"16px",fill:"#ffffff"}).setOrigin(.5,1),this.bossUiContainer.add(this.bossTitleText),this.healthBarBackground=this.scene.add.rectangle(10,-10,t-20,10,5592405).setOrigin(0,1),this.healthBar=this.scene.add.rectangle(10,-10,this.bossHp/this.maxHp*(t-20),10,16711680).setOrigin(0,1),this.bossUiContainer.add(this.healthBarBackground),this.bossUiContainer.add(this.healthBar)}setScaleToFitWindow(){const{width:t,height:e}=this.scene.cameras.main;this.bottomBar.width=t,this.healthBarBackground.width=t-20,this.healthBar.width=this.bossHp/this.maxHp*(t-20),this.bottomBar.setPosition(t/2,0),this.retreatButton.setPosition(10,-40),this.bossNameText.setPosition(t/2,-40),this.bossTitleText.setPosition(t/2,-20),this.healthBarBackground.setPosition(10,-10),this.healthBar.setPosition(10,-10),console.log(t,e),console.log("bossUiContainer",this.bossUiContainer),console.log("bottomBar",this.bottomBar.x,this.bottomBar.y),console.log("retreatButton",this.retreatButton.x,this.retreatButton.y),console.log("bossNameText",this.bossNameText.x,this.bossNameText.y),console.log("bossTitleText",this.bossTitleText.x,this.bossTitleText.y),console.log("healthBar",this.healthBar.x,this.healthBar.y)}updateBossHp(t){this.bossHp=t;const{width:e}=this.scene.cameras.main;this.healthBar.width=this.bossHp/this.maxHp*(e-20)}}class P{constructor(t,e,s,i){this.scene=t,this.playerName=e.name,this.playerHp=s,this.maxHp=i,this.attack=e.attack,this.attackAid=e.attackAid,this.shield=e.shield,this.shieldAid=e.shieldAid,this.heal=e.heal,this.healAid=e.healAid,this.createUI(),this.setScaleToFitWindow(),this.scene.scale.on("resize",this.setScaleToFitWindow,this)}createUI(){const{width:t,height:e}=this.scene.cameras.main;this.uiContainer=this.scene.add.container(0,0),this.topBar=this.scene.add.rectangle(t/2,0,t,50,0).setOrigin(.5,0),this.uiContainer.add(this.topBar),this.playerNameText=this.scene.add.text(64,10,this.playerName,{fontSize:"20px",fill:"#ffffff"}),this.uiContainer.add(this.playerNameText),this.redNumberSlot=this.scene.add.text(100,10,`${this.attack} | ${this.attackAid}`,{fontSize:"20px",fill:"#ff0000"}),this.greenNumberSlot=this.scene.add.text(250,10,`${this.heal} | ${this.healAid}`,{fontSize:"20px",fill:"#00ff00"}),this.blueNumberSlot=this.scene.add.text(400,10,`${this.shield} | ${this.shieldAid}`,{fontSize:"20px",fill:"#0000ff"}),this.uiContainer.add(this.redNumberSlot),this.uiContainer.add(this.greenNumberSlot),this.uiContainer.add(this.blueNumberSlot),this.healthBarBackground=this.scene.add.rectangle(10,40,t-20,10,5592405).setOrigin(0,.5),this.healthBar=this.scene.add.rectangle(10,40,this.playerHp/this.maxHp*(t-20),10,65298).setOrigin(0,.5),this.uiContainer.add(this.healthBarBackground),this.uiContainer.add(this.healthBar)}setScaleToFitWindow(){const{width:t,height:e}=this.scene.cameras.main;this.topBar.width=t,this.healthBarBackground.width=t-20,this.healthBar.width=this.playerHp/this.maxHp*(t-20),this.topBar.setPosition(t/2,0),this.playerNameText.setPosition(64,10),this.redNumberSlot.setPosition(t/2-150,10),this.greenNumberSlot.setPosition(t/2,10),this.blueNumberSlot.setPosition(t/2+150,10),this.healthBarBackground.setPosition(10,40),this.healthBar.setPosition(10,40)}updatePlayerHp(t){this.playerHp=t;const{width:e}=this.scene.cameras.main;this.healthBar.width=this.playerHp/this.maxHp*(e-20)}updateItem(){this.redNumberSlot.setText(`${i.account.attack} | ${i.account.attackAid}`),this.greenNumberSlot.setText(`${i.account.heal} | ${i.account.healAid}`),this.blueNumberSlot.setText(`${i.account.shield} | ${i.account.shieldAid}`)}}class M extends s.Scene{constructor(){super("Game"),this.router=n(),this.timerInterval=1e3}create(){this.timerEvent=this.time.addEvent({delay:this.timerInterval,callback:this.onTimerEvent,callbackScope:this,loop:!0});const t=v,e=B;this.activeRoomId=i.activeRoom.id,this.activeRoomId&&5!=this.activeRoomId?this.playerMaxHp=i.account.health+i.healthMod[this.activeRoomId]:this.playerMaxHp=i.account.health,this.playerHp=this.playerMaxHp;const s=Phaser.Math.RND.pick(t),a=Phaser.Math.RND.pick(e);this.cameras.main.setBackgroundColor(16753920),this.background=this.add.image(0,0,["beachBG","forestBG","mountainBG","cliffBG","islandBG"][i.activeRoom.id-1]).setOrigin(0,0).setDisplaySize(this.cameras.main.width,this.cameras.main.height);const o=this.cameras.main.centerX,n=this.cameras.main.centerY;this.dragon=new x(this,o,n),this.bossUi=new _(this,s,a,this.dragon.dragonHP,this.dragon.dragonHPMax),this.playerUi=new P(this,i.account,this.playerHp,this.playerMaxHp),this.item=new D(this,o,n),this.dragonAttack=new A(this,this.dragon),this.dragonAttack.startAttack(),this.slash=new T(this,o,n),this.scale.on("resize",this.resize,this),this.resize({width:this.scale.width,height:this.scale.height}),b.emit("current-scene-ready",this)}onTimerEvent(){this.dragon&&this.dragonAttack.update()}resize(t,e,s,i){const a=t.width,o=t.height;this.cameras.resize(a,o),this.background.setDisplaySize(a,o)}leaveRoom(){this.sound.stopAll(),this.scene.start("GameResults")}changeScene(){this.scene.start("GameOver")}update(){this.dragonAttack.update()}}class R extends s.Scene{constructor(){super("GameOver")}create(){this.keptGold=Phaser.Math.RoundTo(.9*i.account.gold,0),this.lostGoldAmount=i.account.gold-=this.keptGold,this.loseGold(this.keptGold),this.backgroundMusic=this.sound.add("gameOverBGM",{volume:.5,loop:!0}),this.backgroundMusic.play(),this.cameras.main.setBackgroundColor(16729344),this.background=this.add.image(0,0,"gameOverBG").setOrigin(0,0).setDisplaySize(this.cameras.main.width,this.cameras.main.height);const t=this.cameras.main.centerX,e=this.cameras.main.centerY;this.lostGold=this.add.text(t,e-100,`${this.lostGoldAmount} Gold was lost`,{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setDepth(100),this.gameOver=this.add.text(t,e,"Game Over",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setDepth(100),this.fight=this.add.text(t,e+100,"FIGHT!",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setDepth(100).setInteractive(),this.fight.on("pointerdown",(()=>{this.sound.stopAll(),this.scene.start("Map")})),this.fight.on("pointerover",(()=>{this.fight.setColor("red"),this.input.setDefaultCursor("pointer")})),this.fight.on("pointerout",(()=>{this.fight.setColor("#ffffff"),this.input.setDefaultCursor("default")})),this.return=this.add.text(t,e+200,"RETREAT...",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setDepth(100).setInteractive(),this.return.on("pointerdown",(()=>{b.emit("navigate-home")})),this.return.on("pointerover",(()=>{this.return.setColor("white"),this.input.setDefaultCursor("pointer")})),this.return.on("pointerout",(()=>{this.return.setColor("gray"),this.input.setDefaultCursor("default")})),this.scale.on("resize",this.resize,this),this.resize({width:this.scale.width,height:this.scale.height}),this.adjustTextSize(),b.emit("current-scene-ready",this)}resize(t,e,s,i){const a=t.width,o=t.height;this.cameras.resize(a,o),this.background.setDisplaySize(a,o);const n=this.cameras.main.centerX,h=this.cameras.main.centerY;this.lostGold.setPosition(n,h-100),this.gameOver.setPosition(n,h),this.fight.setPosition(n,h+100),this.return.setPosition(n,h+200),this.adjustTextSize()}loseGold(t){i.account.gold=t;const e=i.account;o.editAccount(e)}setFontToFitWindow(){const{width:t,height:e}=this.cameras.main;return 64*Math.min(t/1600,e/1200)}adjustTextSize(){const t=`${this.setFontToFitWindow()}px`;this.return.setStyle({fontSize:t})}changeScene(){this.scene.start("MainMenu")}}class O extends s.Scene{constructor(){super("GameResults")}create(){this.backgroundMusic=this.sound.add("victoryBGM",{volume:.5,loop:!1}),this.backgroundMusic.play(),this.getBossData(),this.cameras.main.setBackgroundColor(16729344),this.background=this.add.image(0,0,"darkDragonBG").setOrigin(0,0).setDisplaySize(this.cameras.main.width,this.cameras.main.height),this.updateBossHP();const t=this.cameras.main.centerX,e=this.cameras.main.centerY;this.rewardItems={attack:0,shield:0,heal:0},this.title=this.add.text(t,e-200,`${i.bossDamage} Damage dealt to ${i.activeBoss.name}`,{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setDepth(100);const s=i.activeBoss.hp-i.activeBoss.damages-i.bossDamage;this.bossHp=this.add.text(t,e-100,`${s} Hp remains`,{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setDepth(100),this.rewards=this.add.text(t,e,`+${i.gold} Gold | +${i.valor} Valor \n Attack: ${this.rewardItems.attack} | Shield: ${this.rewardItems.shield} | Heal: ${this.rewardItems.heal}`,{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setDepth(100),this.fight=this.add.text(t,e+100,`FIGHT! | ${i.winStreak} : Streak`,{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setDepth(100).setInteractive(),this.fight.on("pointerdown",(()=>{this.sound.stopAll(),this.backgroundMusic=this.sound.add("DragonKingDungeon",{volume:.5,loop:!0}),this.backgroundMusic.play(),this.scene.start("Game")})),this.fight.on("pointerover",(()=>{this.fight.setColor("red"),this.input.setDefaultCursor("pointer")})),this.fight.on("pointerout",(()=>{this.fight.setColor("#ffffff"),this.input.setDefaultCursor("default")})),this.return=this.add.text(t,e+200,"RETREAT...",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setDepth(100).setInteractive(),this.return.on("pointerdown",(()=>{b.emit("navigate-home")})),this.return.on("pointerover",(()=>{this.return.setColor("white"),this.input.setDefaultCursor("pointer")})),this.return.on("pointerout",(()=>{this.return.setColor("gray"),this.input.setDefaultCursor("default")})),this.adjustTextSize(),this.updateAccount(),b.emit("current-scene-ready",this)}resize(t,e,s,i){const a=t.width,o=t.height;this.cameras.resize(a,o),this.background.setDisplaySize(a,o);const n=this.cameras.main.centerX,h=this.cameras.main.centerY;this.title.setPosition(n,h-200),this.bossHp.setPosition(n,h-100),this.rewards.setPosition(n,h),this.fight.setPosition(n,h+100),this.return.setPosition(n,h+200),this.adjustTextSize()}setFontToFitWindow(){const{width:t,height:e}=this.cameras.main;return 64*Math.min(t/1600,e/1200)}adjustTextSize(){const t=`${this.setFontToFitWindow()}px`;this.title.setStyle({fontSize:t}),this.bossHp.setStyle({fontSize:t}),this.rewards.setStyle({fontSize:t}),this.fight.setStyle({fontSize:t}),this.return.setStyle({fontSize:t})}getBossData(){h.getBosses()}lootTable(){const t=i.activeRoom.difficulty/100;this.activeRoomId&&5!=this.activeRoomId?this.luckMod=i.luckMod[this.activeRoomId]:this.luckMod=0;const e=t+.1*this.luckMod;["attack","shield","heal"].forEach((t=>{Math.random()<e&&this.rewardItems[t]++})),this.rewards.setText(`+${i.gold} Gold | +${i.valor} Valor \n Attack: ${this.rewardItems.attack} | Shield: ${this.rewardItems.shield} | Heal: ${this.rewardItems.heal}`)}async updateAccount(){try{this.lootTable();const t={gold:i.account.gold+i.gold,valor:i.account.valor+i.valor,attack:i.account.attack+this.rewardItems.attack,shield:i.account.shield+this.rewardItems.shield,heal:i.account.heal+this.rewardItems.heal};await o.editAccount(t)}catch(t){r.error(t.message,"[UPDATE ACCOUNT - GAME RESULT]")}}async updateBossHP(){try{const t={dmg:i.bossDamage,bossId:i.activeBoss.id};await c.createOrIncreaseBossDamage(t)}catch(t){r.error(t.message,"[]")}}}class H extends s.Scene{constructor(){super("Map")}create(){i.winStreak=0,this.backgroundMusic=this.sound.add("DragonKingDungeon",{volume:.5,loop:!0}),this.backgroundMusic.play(),this.cameras.main.setBackgroundColor(16729344),this.background=this.add.image(0,0,"mapBG").setOrigin(0,0).setDisplaySize(this.cameras.main.width,this.cameras.main.height),this.createButtons(),this.scale.on("resize",this.resize,this),b.emit("current-scene-ready",this)}createButtons(){this.getFontSize(),this.topLeftButton=this.add.text(0,0,"Toleftios\nEasy",{fontFamily:"Arial Black",fontSize:32,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(0,0).setInteractive().on("pointerdown",(()=>this.buttonAction("Top Left",1))).on("pointerover",(()=>this.buttonOver(this.topLeftButton))).on("pointerout",(()=>this.buttonOut(this.topLeftButton))),this.topRightButton=this.add.text(0,0,"Rysto\nMedium",{fontFamily:"Arial Black",fontSize:32,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(1,0).setInteractive().on("pointerdown",(()=>this.buttonAction("Top Right",2))).on("pointerover",(()=>this.buttonOver(this.topRightButton))).on("pointerout",(()=>this.buttonOut(this.topRightButton))),this.centerButton=this.add.text(0,0,"Centeria\nSafe",{fontFamily:"Arial Black",fontSize:32,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5).setInteractive().on("pointerdown",(()=>this.buttonAction("Center",5))).on("pointerover",(()=>this.buttonOver(this.centerButton))).on("pointerout",(()=>this.buttonOut(this.centerButton))),this.bottomRightButton=this.add.text(0,0,"Boghir\nExtreme",{fontFamily:"Arial Black",fontSize:32,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(1,1).setInteractive().on("pointerdown",(()=>this.buttonAction("Bottom Right",4))).on("pointerover",(()=>this.buttonOver(this.bottomRightButton))).on("pointerout",(()=>this.buttonOut(this.bottomRightButton))),this.bottomLeftButton=this.add.text(0,0,"Lendbom\nHard",{fontFamily:"Arial Black",fontSize:32,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(0,1).setInteractive().on("pointerdown",(()=>this.buttonAction("Bottom Left",3))).on("pointerover",(()=>this.buttonOver(this.bottomLeftButton))).on("pointerout",(()=>this.buttonOut(this.bottomLeftButton))),this.resize()}positionButtons(){const{width:t,height:e}=this.cameras.main,s=Math.min(96,Math.max(32,.1*t));this.topLeftButton.setPosition(s,96),this.topRightButton.setPosition(t-s,96),this.centerButton.setPosition(t/2,e/2),this.bottomRightButton.setPosition(t-s,e-96),this.bottomLeftButton.setPosition(s,e-96)}resize(t,e,s,i){const{width:a,height:o}=this.cameras.main;this.cameras.resize(a,o),this.background.setDisplaySize(a,o);const n=this.getFontSize();this.topLeftButton.setFontSize(n),this.topRightButton.setFontSize(n),this.centerButton.setFontSize(n),this.bottomRightButton.setFontSize(n),this.bottomLeftButton.setFontSize(n),this.positionButtons()}getFontSize(){const{width:t,height:e}=this.cameras.main;return 32*Math.min(t/800,e/600)}buttonAction(t,e){i.activeRoom=y.find((t=>t.id==e)),this.changeScene()}buttonOver(t){t.setColor("gray"),this.input.setDefaultCursor("pointer")}buttonOut(t){t.setColor("white"),this.input.setDefaultCursor("default")}changeScene(){this.scene.start("Game")}}class I extends s.Scene{constructor(){var e,s;super("MainMenu"),((e,s,i)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i})(this,"symbol"!=typeof(e="logoTween")?e+"":e,s)}create(){this.add.image(512,384,"background"),this.logo=this.add.image(512,300,"logo").setDepth(100),this.add.text(512,460,"Main Menu",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setDepth(100).setOrigin(.5),b.emit("current-scene-ready",this)}changeScene(){this.logoTween&&(this.logoTween.stop(),this.logoTween=null),this.scene.start("Game")}moveLogo(t){this.logoTween?this.logoTween.isPlaying()?this.logoTween.pause():this.logoTween.play():this.logoTween=this.tweens.add({targets:this.logo,x:{value:750,duration:3e3,ease:"Back.easeInOut"},y:{value:80,duration:1500,ease:"Sine.easeOut"},yoyo:!0,repeat:-1,onUpdate:()=>{t({x:Math.floor(this.logo.x),y:Math.floor(this.logo.y)})}})}}class C extends s.Scene{constructor(){super("Preloader")}init(){}preload(){this.load.setPath("assets"),this.load.audio("DragonKingDungeon","bgm/DragonKingDungeon.mp3"),this.load.audio("gameOverBGM","bgm/gameOverBGM.ogg"),this.load.audio("victoryBGM","bgm/victoryBGM.wav"),this.load.audio("dragonAttack_1","sound/mnstr5.wav"),this.load.audio("dragonAttack_2","sound/mnstr6.wav"),this.load.audio("dragonAttack_3","sound/mnstr8.wav"),this.load.audio("dragonAttack_4","sound/mnstr13.wav"),this.load.audio("dragonAttack_5","sound/mnstr14.wav"),this.load.audio("swish_2","sound/swish_2.wav"),this.load.audio("swish_3","sound/swish_3.wav"),this.load.audio("swish_4","sound/swish_4.wav"),this.load.audio("swish_3","sound/swish_3.wav"),this.load.audio("attackItem","sound/magic1.wav"),this.load.audio("healItem","sound/spell.wav"),this.load.image("star","star.png"),this.load.image("gameOverBG","gameOver1.jpeg"),this.load.image("castleGroundBG","castleGrounds.jpeg"),this.load.image("darkDragonBG","darkDragon.jpeg"),this.load.image("mapBG","map4.jpeg"),this.load.image("beachBG","room/beach.jpg"),this.load.image("cliffBG","room/cliff.jpg"),this.load.image("forestBG","room/forest.jpg"),this.load.image("islandBG","castleGrounds.jpeg"),this.load.image("mountainBG","room/mountain.jpg"),this.load.image("dragon","dragon_2.png"),this.load.image("dragon_1","dragon/dragon_1.gif"),this.load.image("dragon_2","dragon/dragon_2.png"),this.load.image("dragon_3","dragon/dragon_3.png"),this.load.image("dragon_4","dragon/dragon_4.png"),this.load.image("dragon_5","dragon/dragon_5.png"),this.load.image("dragon_6","dragon/dragon_6.png"),this.load.image("dragon_7","dragon/dragon_7.png"),this.load.image("dragon_8","dragon/dragon_8.png"),this.load.image("dragon_9","dragon/dragon_9.png"),this.load.image("dragon_10","dragon/dragon_10.png"),this.load.image("small_0001","battle/small_0001.png"),this.load.image("small_0004","battle/small_0004.png"),this.load.image("small_0006","battle/small_0006.png"),this.load.image("small_0010","battle/small_0010.png"),this.load.image("small_0015","battle/small_0015.png"),this.load.image("small_0019","battle/small_0019.png"),this.load.image("small_0020","battle/small_0020.png"),this.load.image("small_0022","battle/small_0022.png"),this.load.image("small_0026","battle/small_0026.png"),this.load.image("small_0030","battle/small_0030.png"),this.load.image("small_0032","battle/small_0032.png"),this.load.image("small_0034","battle/small_0034.png"),this.load.image("small_0036","battle/small_0036.png"),this.load.image("small_0037","battle/small_0037.png")}create(){this.scene.start("Map")}}const z={type:e.AUTO,scale:{mode:e.Scale.FIT,autoCenter:e.Scale.NO_CENTER,width:window.innerWidth,height:window.innerHeight-16},parent:"game-container",backgroundColor:"#000000",scene:[S,C,I,M,R,O,H]},G={id:"game-container"},F={__name:"PhaserGame",emits:["current-active-scene"],setup(t,{expose:s,emit:i}){const o=l(),n=l(),h=i;return d((()=>{n.value=("game-container",new e.Game({...z,parent:"game-container"})),b.on("current-scene-ready",(t=>{h("current-active-scene",t),o.value=t})),b.on("navigate-home",(()=>{a.log("go Home"),g.push("/")}))})),u((()=>{n.value&&(n.value.destroy(!0),n.value=null)})),s({scene:o,game:n}),(t,e)=>(m(),p("div",G))}},N={class:"container-fluid"},j={class:"row pt-3"},W={class:"game-window col-12"},$={__name:"GamePage",setup(t){d((()=>{e(),async function(){try{await f.getMessages()}catch(t){r.error(t.message)}}()}));const e=()=>{const t=document.querySelector("main");if(t){let e="https://images.unsplash.com/photo-1569470451072-68314f596aec?q=80&w=1031&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D";t.style.backgroundImage=`linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.90) 100%), url(${e})`}},s=l(),i=l();l({x:0,y:0});const a=t=>{s.value="MainMenu"!==t.scene.key};return(t,e)=>(m(),p("div",N,[k("div",j,[k("div",W,[w(F,{ref_key:"phaserRef",ref:i,onCurrentActiveScene:a},null,512)])])]))}};export{$ as default};
